<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lorenzo SharePoint Helper – Demo</title>
  <style>
    /* === THEME: Black + Red (único) === */
    :root{
      --bg:#0a0a0a;
      --panel:#0c0c0f;
      --panel-2:#09090b;
      --accent:#ef4444;     /* rojo principal */
      --accent-2:#b91c1c;   /* rojo profundo */
      --text:#f3f4f6;
      --muted:#9ca3af;
      --danger:#ef4444;
      --bot:#121217;
      --me:#ef4444;

      --radius:18px;
      --pad:clamp(10px, 1.2vw, 16px);
      --fs:clamp(14px, 1.6vw, 15px);
      --fs-sm:clamp(11.5px, 1.2vw, 12.5px);
      --avatar:clamp(32px, 4vw, 40px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(239,68,68,.08), transparent 60%),
        radial-gradient(900px 700px at 100% 0%, rgba(185,28,28,.10), transparent 55%),
        linear-gradient(180deg, var(--bg), #050505 60%);
      color:var(--text);
      font: var(--fs)/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";
      display:flex;align-items:center;justify-content:center;padding: clamp(10px,2vw,20px);
    }

    .card{
      width:min(920px, 95vw);
      height:min(78svh, 700px);
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border:1px solid rgba(239,68,68,.12);
      border-radius:var(--radius);
      box-shadow: 0 18px 40px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.04);
      display:grid; grid-template-rows:auto auto 1fr auto;
      overflow:hidden;
    }

    .header{
      display:flex; align-items:center; gap:12px;
      padding:14px 16px; border-bottom:1px solid rgba(239,68,68,.14);
      background: linear-gradient(180deg, #0d0d10e6, #0a0a0de6);
      position:relative;
    }

    .avatar{
      width:var(--avatar); height:var(--avatar); border-radius:25%;
      background-image:url("botpicture1.png");
      background-size:contain; background-position:center; background-repeat:no-repeat;
      box-shadow:0 0 0 3px #0b0f14cc, 0 0 16px #ef444480, 0 0 32px #ef444440;
      flex:0 0 auto;
    }

    .title{font-weight:650; letter-spacing:.2px; font-size:clamp(14px,2vw,16px)}
    .subtitle{color:var(--muted); font-size:var(--fs-sm)}
    .status{position:absolute; right:16px; top:14px; color:var(--muted); font-size:var(--fs-sm); display:flex; align-items:center; gap:6px;}
    .pulse{width:6px;height:6px;border-radius:50%; background:var(--accent); box-shadow:0 0 0 0 var(--accent); animation:pulse 1.8s infinite}
    @keyframes pulse { 0%{box-shadow:0 0 0 0 var(--accent)} 70%{box-shadow:0 0 0 10px transparent} 100%{box-shadow:0 0 0 0 transparent} }

    .quick{
      display:grid; gap:8px; padding:10px 12px;
      border-bottom:1px solid rgba(239,68,68,.12); background:#060606cc;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
    .quick button{
      padding:8px 12px; border-radius:10px; border:1px solid rgba(239,68,68,.20);
      background:linear-gradient(180deg,#111114,#0a0a0d); color:var(--text); cursor:pointer;
      font-size:clamp(12px,1.5vw,14px);
    }
    .quick button:hover{
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(239,68,68,.12) inset, 0 6px 20px rgba(239,68,68,.15);
    }

    .log{
      padding:16px; overflow:auto; display:flex; flex-direction:column; gap:10px;
      background:
        radial-gradient(600px 400px at 100% 100%, rgba(239,68,68,.12), transparent 60%),
        radial-gradient(600px 400px at 0% 0%, rgba(185,28,28,.08), transparent 50%);
    }
    .msg{
      max-width:78%; padding:10px 12px; border-radius:14px; position:relative;
      backdrop-filter: blur(2px);
      box-shadow:0 6px 18px #0006, inset 0 1px 0 rgba(255,255,255,.04);
      word-wrap:break-word; white-space:pre-wrap;
      font-size:clamp(13px,1.6vw,15px);
    }
    .bot{ background:linear-gradient(180deg, var(--bot), #0e0e13); border:1px solid rgba(239,68,68,.12) }
    .me { background:linear-gradient(180deg, rgba(239,68,68,.25), rgba(185,28,28,.2)); border:1px solid rgba(239,68,68,.45); align-self:flex-end }
    .msg small{ color:var(--muted); display:block; margin-top:6px; font-size:clamp(10px,1.2vw,11px) }

    .typing{ display:inline-flex; gap:6px; align-items:center; }
    .dot{ width:6px; height:6px; border-radius:50%; background:#9ca3af88; animation:bounce 1.3s infinite }
    .dot:nth-child(2){ animation-delay:.15s } .dot:nth-child(3){ animation-delay:.3s }
    @keyframes bounce { 0%,100%{ transform: translateY(0); opacity:.5 } 50%{ transform: translateY(-4px); opacity:1 } }

    .input{
      display:flex; gap:10px; padding:12px; border-top:1px solid rgba(239,68,68,.12); background:#060606cc;
    }
    .input input{
      flex:1; padding:12px 14px; border-radius:12px; border:1px solid rgba(239,68,68,.18); background:#0a0a0a; color:var(--text);
      outline:none; box-shadow: inset 0 1px 0 rgba(255,255,255,.04);
      font-size:clamp(13px,1.6vw,15px);
    }
    .input input:focus{ border-color:var(--accent); box-shadow:0 0 0 3px rgba(239,68,68,.15) }
    .input button{
      padding:0 16px; border-radius:12px; border:1px solid #7f1d1d; background:linear-gradient(180deg, var(--accent), #b91c1c); color:#fff;
      font-weight:600; cursor:pointer; font-size:clamp(12px,1.6vw,14px);
    }
    .input button:disabled{ opacity:.6; cursor:not-allowed; }
    .input button:hover{ filter:brightness(1.05); box-shadow:0 10px 24px rgba(239,68,68,.25) }

    .error{ color:var(--danger) }
    .footnote{ color:var(--muted); font-size:var(--fs-sm); padding:6px 14px 12px }

    @media (max-width:820px){
      .card{ height:min(82svh, 720px) }
      .status{ position:static; margin-left:auto }
    }
    @media (max-width:640px){
      body{ padding:8px }
      .card{ width:100%; height:calc(var(--vh, 1svh) * 100); border-radius:14px }
      .header{ padding:10px 12px; gap:10px }
      .subtitle{ display:none }
      .msg{ max-width:100% }
      .quick{ grid-template-columns:1fr 1fr }
    }
    @media (max-width:400px){
      .quick{ grid-template-columns:1fr }
    }
    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important }
      #topbar span{ animation:none !important }
    }

    /* ===== PRELOADER simple + Top progress ===== */
    #preloader{
      position:fixed; inset:0; z-index:9999;
      background:#000;
      display:flex; align-items:center; justify-content:center;
      transition:opacity .5s ease, visibility .5s ease;
    }
    #preloader.hidden{ opacity:0; visibility:hidden }
    .logo-img{ max-width:400px; width:70%; filter:drop-shadow(0 0 20px rgba(239,68,68,.25)) }

    #topbar{ position:fixed; top:0; left:0; width:100%; height:4px; z-index:10000; pointer-events:none }
    #topbar span{
      display:block; width:0%; height:100%;
      background:linear-gradient(90deg,#7f1d1d,#ef4444,#7f1d1d);
      background-size:200% 100%;
      box-shadow:0 0 10px #ef4444, 0 0 30px #ef444480, 0 0 60px #ef444440;
      animation:shimmer 1.2s linear infinite, glow 1.8s ease-in-out infinite alternate;
      transition:width .5s ease;
    }
    @keyframes shimmer { from{background-position:0 0} to{background-position:200% 0} }
    @keyframes glow { from{box-shadow:0 0 8px #ef4444,0 0 0 #0000} to{box-shadow:0 0 16px #ef4444,0 0 40px #ef444480} }

    ::selection{ background:rgba(239,68,68,.35); color:#fff }
    ::-webkit-scrollbar{ height:10px; width:10px }
    ::-webkit-scrollbar-thumb{ background: linear-gradient(#b91c1c,#7f1d1d); border-radius:10px }

/* Añade/ajusta estas variables en :root */
:root{
  /* ...lo que ya tienes... */
  --logo-max: 620px;     /* tamaño máximo del logo en px (ajústalo) */
  --logo-scale: 1.6;     /* escala final del zoom (1 = tamaño real) */
}

/* Centrado perfecto del preloader */
#preloader{
  position:fixed; inset:0; z-index:9999;
  background:#000;
  /* usa grid para centrar al 100% */
  display:grid; place-items:center;
  transition:opacity .5s ease, visibility .5s ease;
}

/* Logo con animación de acercamiento */
.logo-img{
  width: min(70vw, var(--logo-max));   /* más grande que antes */
  height: auto;
  filter: drop-shadow(0 0 20px rgba(239,68,68,.25));
  transform-origin:center;
  opacity:0; transform: scale(.9);     /* arranca pequeño */
  will-change: transform, opacity;
  animation: popIn .9s cubic-bezier(.2,.8,.2,1) .1s forwards;
}

/* Keyframes del zoom */
@keyframes popIn{
  0%   { transform: scale(.6);  opacity:0; }
  60%  { transform: scale(calc(var(--logo-scale) * 1.25)); opacity:1; } /* pequeño “overshoot” */
  100% { transform: scale(var(--logo-scale)); opacity:1; }
}

/* opcional: pulso sutil mientras está visible */
.logo-img.pulse {
  animation: popIn 1s cubic-bezier(.9,.8,.8,1) .5s forwards,
             breathe 2.4s ease-in-out 1s infinite;
}
@keyframes breathe{
  0%,100%{ transform: scale(var(--logo-scale)); }
  50%    { transform: scale(calc(var(--logo-scale) * 1.03)); }
}


  </style>
</head>
<body>
  <div id="topbar"><span></span></div>

  <div id="preloader">
    <div class="preloader-wrap">
      <img src="preload.png" alt="Logo" class="logo-img">
    </div>
  </div>

  <div class="card" role="application" aria-label="SharePoint Helper Chat">
    <div class="header">
      <div class="avatar" aria-hidden="true"></div>
      <div>
        <div class="title">Lorenzo SharePoint Helper</div>
        <div class="subtitle">Asistente de SharePoint</div>
      </div>
      <div class="status"><span class="pulse" aria-hidden="true"></span> Ready</div>
    </div>

    <div class="quick" id="quickbar">
      <button data-q="¿Cómo pido acceso a un sitio de SharePoint?">Acceso a sitio</button>
      <button data-q="¿Cómo solicito permisos a una carpeta o biblioteca específica?">Permisos</button>
      <button data-q="¿Cómo subo un documento a SharePoint?">Subir documento</button>
      <button data-q="¿Cómo restauro un archivo eliminado?">Restaurar archivo</button>
      <button data-q="¿Puedo compartir archivos con alguien externo a la organización?">Compartir externo</button>
      <button data-q="¿Cuál es la diferencia entre Miembro y Propietario?">Roles</button>
      <button onclick="window.location.href='https://globaldenso.sharepoint.com/sites/NA_000451/SitePages/PRUEBAS-BOT.aspx'">
    🔙 Volver a SharePoint
  </button>
    </div>
    
    <div id="log" class="log" aria-live="polite">
      <div class="msg bot">¡Hola! Soy Lorenzo el bot de Denso. Elige una opción de arriba para empezar.
        <small>bot · ahora</small>
      </div>
    </div>

    <form id="form" class="input" autocomplete="off" style="display:none">
      <input id="q" type="text" placeholder="Escribe tu pregunta… (Enter para enviar)" aria-label="Tu mensaje">
      <button id="send" type="submit">Enviar</button>
    </form>
    <div class="footnote">
      Demo temporal. Después de probar, regenera clave en Azure (<span class="kbd">Keys and Endpoint</span>).
    </div>
  </div>

  <script>
    const ENDPOINT = "https://sharepoint-helper-lang.cognitiveservices.azure.com";
    const PROJECT  = "SharePointHelperKB";
    const DEPLOY   = "production";
    const API_VER  = "2021-10-01";
    const KEY      = "PoL5AILp8KagtVUZ1k9OwSsyjDIsTlLhbxRRReQpHX0Piaaxvy4dJQQJ99BHACYeBjFXJ3w3AAAaACOGo4Ai";

    const logEl = document.getElementById('log');
    const quick = document.getElementById('quickbar');

    function setVh(){ document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`) }
    setVh(); window.addEventListener('resize', setVh);

    function addMsg(text, who='bot'){
      const wrap = document.createElement('div');
      wrap.className = 'msg ' + (who === 'me' ? 'me' : 'bot');
      wrap.innerText = text;
      const meta = document.createElement('small');
      meta.textContent = (who==='me' ? 'tú' : 'bot') + ' · ' + new Date().toLocaleTimeString();
      wrap.appendChild(meta);
      logEl.appendChild(wrap);
      logEl.scrollTop = logEl.scrollHeight;
      return wrap;
    }

    function addTyping(){
      const d = document.createElement('div');
      d.className = 'msg bot';
      d.innerHTML = '<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span><small>bot · escribiendo…</small>';
      logEl.appendChild(d);
      logEl.scrollTop = logEl.scrollHeight;
      return d;
    }

    async function ask(question){
      const url = `${ENDPOINT}/language/:query-knowledgebases?projectName=${encodeURIComponent(PROJECT)}&deploymentName=${encodeURIComponent(DEPLOY)}&api-version=${API_VER}`;
      const res = await fetch(url, {
        method: "POST",
        headers: { "Ocp-Apim-Subscription-Key": KEY, "Content-Type": "application/json" },
        body: JSON.stringify({ question, top: 1 })
      });
      if(!res.ok){
        let t = await res.text().catch(()=>'' );
        throw new Error(res.status + ' ' + res.statusText + (t?(' – ' + t):''));
      }
      return res.json();
    }

    async function sendQuestion(q){
      addMsg(q, 'me');
      const typing = addTyping();
      try{
        const json = await ask(q);
        typing.remove();
        const a = (json.answers && json.answers[0] && json.answers[0].answer) || '(sin respuesta)';
        addMsg(a, 'bot');
      }catch(err){
        typing.remove();
        addMsg('Error: ' + err.message, 'bot').classList.add('error');
      }
    }

    quick.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-q]');
      if(!btn) return;
      sendQuestion(btn.getAttribute('data-q'));
    });

    /* ===== Preloader duration + topbar progress ===== */
    const MIN_PRELOADER_TIME = 2000; // ajusta a 3000-4000 si quieres
    const bar = document.querySelector('#topbar span');
    let p = 0;
    const startTime = Date.now();

    const tick = setInterval(()=>{
      p += Math.max(5, (100 - p) * 0.25);
      if (p > 100) p = 100;
      bar.style.width = p + '%';
      if (p === 100) clearInterval(tick);
    }, 80);

    window.addEventListener('load', ()=>{
      const elapsed = Date.now() - startTime;
      const remaining = Math.max(0, MIN_PRELOADER_TIME - elapsed);
      setTimeout(()=>{
        document.getElementById('preloader')?.classList.add('hidden');
        const topbar = document.getElementById('topbar');
        topbar.style.transition = 'opacity .5s ease';
        topbar.style.opacity = '0';
        setTimeout(()=> topbar.remove(), 600);
      }, remaining);
    });
  </script>
</body>
</html>
