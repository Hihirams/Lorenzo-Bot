<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lorenzo SharePoint Helper – Demo</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#111827;
      --panel-2:#0f172a;
      --accent:#60a5fa;
      --accent-2:#22d3ee;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --danger:#ef4444;
      --bot:#1f2937;
      --me:#0ea5e9;

      /* escalas fluidas */
      --radius: 18px;
      --pad: clamp(10px, 1.2vw, 16px);
      --fs: clamp(14px, 1.6vw, 15px);
      --fs-sm: clamp(11.5px, 1.2vw, 12.5px);
      --avatar: clamp(32px, 4vw, 40px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 800px at 10% -10%, #1e293b33, transparent 60%),
        radial-gradient(900px 700px at 100% 0%, #0ea5e933, transparent 55%),
        linear-gradient(180deg, var(--bg), #0a0f16 60%);
      color:var(--text);
      font: var(--fs)/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";
      display:flex;align-items:center;justify-content:center;padding: clamp(10px,2vw,20px);
    }

    .card{
      width: min(920px, 95vw);
      /* Alto usa unidad segura de viewport en móviles (ajustada por JS) */
      height: min(78svh, 700px);
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border:1px solid #1f2937;
      border-radius: var(--radius);
      box-shadow: 0 10px 30px #0008, inset 0 1px 0 #ffffff08;
      display:grid; grid-template-rows: auto auto 1fr auto;
      overflow:hidden;
    }

    .header{
      display:flex; align-items:center; gap:12px;
      padding:14px 16px; border-bottom:1px solid #1f2937;
      background: linear-gradient(180deg, #111827aa, #0b1220aa);
      position:relative;
    }

    .avatar{
      width:var(--avatar); height:var(--avatar); border-radius:50%;
      background-image: url("botpicture.png"); /* usa ruta server-relative */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      box-shadow: 0 0 0 3px #0b0f14cc;
      flex: 0 0 auto;
    }

    .title{font-weight:650; letter-spacing:.2px; font-size: clamp(14px,2vw,16px)}
    .subtitle{color:var(--muted); font-size:var(--fs-sm)}
    .status{
      position:absolute; right:16px; top:14px; color:var(--muted); font-size:var(--fs-sm);
      display:flex; align-items:center; gap:6px;
    }
    .pulse{width:6px;height:6px;border-radius:50%; background: #34d399; box-shadow:0 0 0 0 #34d399; animation:pulse 1.8s infinite}
    @keyframes pulse { 0%{box-shadow:0 0 0 0 #34d399} 70%{box-shadow:0 0 0 10px transparent} 100%{box-shadow:0 0 0 0 transparent} }

    .quick{
      display:grid; gap:8px; padding:10px 12px;
      border-bottom:1px solid #1f2937; background:#0b0f14b3;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
    .quick button{
      padding:8px 12px; border-radius:10px; border:1px solid #2b3750;
      background:linear-gradient(180deg,#0f172a,#0b1020); color:var(--text); cursor:pointer;
      font-size: clamp(12px,1.5vw,14px);
    }
    .quick button:hover{ border-color:#3b82f6 }

    .log{
      padding:16px; overflow:auto;
      display:flex; flex-direction:column; gap:10px;
      background:
        radial-gradient(600px 400px at 100% 100%, #1d283a55, transparent 60%),
        radial-gradient(600px 400px at 0% 0%, #0ea5e920, transparent 50%);
    }
    .msg{
      max-width: 78%;
      padding:10px 12px; border-radius: 14px; position:relative;
      backdrop-filter: blur(2px);
      box-shadow: 0 6px 18px #0006, inset 0 1px 0 #ffffff08;
      word-wrap: break-word; white-space: pre-wrap;
      font-size: clamp(13px,1.6vw,15px);
    }
    .bot{ background: linear-gradient(180deg, #111827, #0e1626); border:1px solid #1f2937; }
    .me { background: linear-gradient(180deg, #0ea5e950, #22d3ee40); border:1px solid #0ea5e955; align-self:flex-end }
    .msg small{ color:var(--muted); display:block; margin-top:6px; font-size: clamp(10px,1.2vw,11px) }
    .typing{ display:inline-flex; gap:6px; align-items:center; }
    .dot{ width:6px; height:6px; border-radius:50%; background:#9ca3af88; animation: bounce 1.3s infinite }
    .dot:nth-child(2){ animation-delay:.15s } .dot:nth-child(3){ animation-delay:.3s }
    @keyframes bounce { 0%,100%{ transform: translateY(0); opacity:.5 } 50%{ transform: translateY(-4px); opacity:1 } }

    .input{
      display:flex; gap:10px; padding:12px; border-top:1px solid #1f2937; background:#0b0f14b3;
    }
    .input input{
      flex:1; padding:12px 14px; border-radius:12px; border:1px solid #1f2937; background:#0b0f14; color:var(--text);
      outline: none; box-shadow: inset 0 1px 0 #ffffff08;
      font-size: clamp(13px,1.6vw,15px);
    }
    .input button{
      padding:0 16px; border-radius:12px; border:1px solid #2563eb; background: linear-gradient(180deg, #2563eb, #1d4ed8); color:#fff;
      font-weight:600; cursor:pointer; font-size: clamp(12px,1.6vw,14px);
    }
    .input button:disabled{ opacity:.6; cursor:not-allowed; }

    .error{ color: var(--danger); }
    .footnote{ color:var(--muted); font-size:var(--fs-sm); padding:6px 14px 12px }

    /* ====== RESPONSIVE ====== */
    @media (max-width: 820px){
      .card{ height: min(82svh, 720px); }
      .status{ position:static; margin-left:auto; }
    }

    @media (max-width: 640px){
      body{ padding: 8px; }
      .card{
        width: 100%;
        height: calc(var(--vh, 1svh) * 100); /* corrige barra de direcciones móvil */
        border-radius: 14px;
      }
      .header{ padding:10px 12px; gap:10px; }
      .subtitle{ display:none; } /* ganamos espacio */
      .msg{ max-width: 100%; }   /* burbujas ancho completo */
      .quick{ grid-template-columns: 1fr 1fr; }
    }

    @media (max-width: 400px){
      .quick{ grid-template-columns: 1fr; }
      .avatar{ box-shadow: 0 0 0 2px #0b0f14cc; }
    }

    /* Accesibilidad: menos animación si el usuario lo pide */
    @media (prefers-reduced-motion: reduce){
      *{animation:none !important; transition:none !important}
    }
  </style>
</head>
<body>
  <div class="card" role="application" aria-label="SharePoint Helper Chat">
    <div class="header">
      <div class="avatar" aria-hidden="true"></div>
      <div>
        <div class="title">Lorenzo SharePoint Helper</div>
        <div class="subtitle">Asistente de SharePoint</div>
      </div>
      <div class="status"><span class="pulse" aria-hidden="true"></span> Ready</div>
    </div>

    <div class="quick" id="quickbar">
      <button data-q="¿Cómo pido acceso a un sitio de SharePoint?">Acceso a sitio</button>
      <button data-q="¿Cómo solicito permisos a una carpeta o biblioteca específica?">Permisos</button>
      <button data-q="¿Cómo subo un documento a SharePoint?">Subir documento</button>
      <button data-q="¿Cómo restauro un archivo eliminado?">Restaurar archivo</button>
      <button data-q="¿Puedo compartir archivos con alguien externo a la organización?">Compartir externo</button>
      <button data-q="¿Cuál es la diferencia entre Miembro y Propietario?">Roles</button>
    </div>

    <div id="log" class="log" aria-live="polite">
      <div class="msg bot">
        ¡Hola! Soy Lorenzo tu asistente de SharePoint. Elige una opción de arriba para empezar.
        <small>bot · ahora</small>
      </div>
    </div>

    <form id="form" class="input" autocomplete="off" style="display:none">
      <input id="q" type="text" placeholder="Escribe tu pregunta… (Enter para enviar)" aria-label="Tu mensaje">
      <button id="send" type="submit">Enviar</button>
    </form>
    <div class="footnote">
      Demo temporal. Después de probar, regenera clave en Azure (<span class="kbd">Keys and Endpoint</span>).
    </div>
  </div>

  <script>
    // ===== CONFIG =====
    const ENDPOINT = "https://sharepoint-helper-lang.cognitiveservices.azure.com";
    const PROJECT  = "SharePointHelperKB";
    const DEPLOY   = "production";
    const API_VER  = "2021-10-01";
    const KEY      = "PoL5AILp8KagtVUZ1k9OwSsyjDIsTlLhbxRRReQpHX0Piaaxvy4dJQQJ99BHACYeBjFXJ3w3AAAaACOGo4Ai"; // ⚠️ Solo demo

    const logEl = document.getElementById('log');
    const quick = document.getElementById('quickbar');

    // Fix 100vh en iOS/Android: calcula --vh en tiempo real
    function setVh(){
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    setVh(); window.addEventListener('resize', setVh);

    function addMsg(text, who='bot'){
      const wrap = document.createElement('div');
      wrap.className = 'msg ' + (who === 'me' ? 'me' : 'bot');
      wrap.innerText = text;
      const meta = document.createElement('small');
      meta.textContent = (who==='me' ? 'tú' : 'bot') + ' · ' + new Date().toLocaleTimeString();
      wrap.appendChild(meta);
      logEl.appendChild(wrap);
      logEl.scrollTop = logEl.scrollHeight;
      return wrap;
    }

    function addTyping(){
      const d = document.createElement('div');
      d.className = 'msg bot';
      d.innerHTML = '<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span><small>bot · escribiendo…</small>';
      logEl.appendChild(d);
      logEl.scrollTop = logEl.scrollHeight;
      return d;
    }

    async function ask(question){
      const url = `${ENDPOINT}/language/:query-knowledgebases?projectName=${encodeURIComponent(PROJECT)}&deploymentName=${encodeURIComponent(DEPLOY)}&api-version=${API_VER}`;
      const res = await fetch(url, {
        method: "POST",
        headers: { "Ocp-Apim-Subscription-Key": KEY, "Content-Type": "application/json" },
        body: JSON.stringify({ question, top: 1 })
      });
      if(!res.ok){
        let t = await res.text().catch(()=>'');
        throw new Error(res.status + ' ' + res.statusText + (t?(' – ' + t):''));
      }
      return res.json();
    }

    async function sendQuestion(q){
      addMsg(q, 'me');
      const typing = addTyping();
      try{
        const json = await ask(q);
        typing.remove();
        const a = (json.answers && json.answers[0] && json.answers[0].answer) || '(sin respuesta)';
        addMsg(a, 'bot');
      }catch(err){
        typing.remove();
        addMsg('Error: ' + err.message, 'bot').classList.add('error');
      }
    }

    // Click en opciones
    quick.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-q]');
      if(!btn) return;
      const q = btn.getAttribute('data-q');
      sendQuestion(q);
    });
  </script>
</body>
</html>
